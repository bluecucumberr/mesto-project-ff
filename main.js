(()=>{"use strict";var t=document.querySelector("#card-template").content;function e(e,n,o,r,c,u,a,i){var l=t.querySelector(".card").cloneNode(!0),p=l.querySelector(".card__image");l.setAttribute("data-id",e._id),p.src=e.link,l.querySelector(".card__title").textContent=e.name,p.alt=e.name,l.querySelector(".card__like-count").textContent=e.likes.length;var s=l.querySelector(".card__delete-button");e.owner._id!==c?s.remove():s.addEventListener("click",(function(t){return n(t,u)}));var d=l.querySelector(".card__like-button");return e.likes.some((function(t){return t._id===c}))&&d.classList.add("card__like-button_is-active"),d.addEventListener("click",(function(t){o(t,a,i)})),p.addEventListener("click",(function(){return r(p.src,p.alt)})),l}function n(t,e){var n=t.target.closest(".card");e(n.getAttribute("data-id")).then((function(){n.remove()}))}function o(t,e,n){var o=t.target.closest(".card"),r=o.getAttribute("data-id"),c=t.target,u=o.querySelector(".card__like-count");c.classList.contains("card__like-button_is-active")?n(r).then((function(t){c.classList.remove("card__like-button_is-active"),u.textContent=t.likes.length})):e(r).then((function(t){c.classList.add("card__like-button_is-active"),u.textContent=t.likes.length}))}function r(t,e){"function"==typeof e&&e(),t.classList.add("popup_is-opened"),document.addEventListener("keydown",a),document.addEventListener("mousedown",i)}function c(t){(t=document.querySelector(".popup_is-opened"))&&(t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a),document.removeEventListener("mousedown",i))}function u(){var t=document.querySelector(".popup_is-opened");t&&c(t)}function a(t){"Escape"===t.key&&u()}function i(t){if(t.target.classList.contains("popup")){var e=document.querySelector(".popup_is-opened");e&&c(e)}}var l=function(t,e,n,o,r){var c=t.querySelector(".".concat(e.name,"-input-error"));e.classList.add(o),c.textContent=n,c.classList.add(r)},p=function(t,e,n,o){var r=t.querySelector(".".concat(e.name,"-input-error"));e.classList.remove(n),r.classList.remove(o),r.textContent=""},s=function(t,e,n){d(t)?(e.disabled=!0,e.classList.add(n)):(e.disabled=!1,e.classList.remove(n))},d=function(t){return t.some((function(t){return!t.validity.valid}))},_="https://nomoreparties.co/v1/wff-cohort-23",f="d4ecec0a-dd8c-4dd9-8d53-afee648696a4",m=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},v=function(){return fetch(_+"/users/me",{method:"GET",headers:{authorization:f}}).then(m).catch((function(t){console.log("Ошибка при загрузке данных пользователя: ",t)}))},y=function(t){return fetch(_+"/cards/".concat(t),{method:"DELETE",headers:{authorization:f}}).then(m).catch((function(t){console.log("Ошибка при удалении карточки: ",t)}))},h=function(t){return fetch(_+"/cards/likes/".concat(t),{method:"PUT",headers:{authorization:f}}).then(m).catch((function(t){console.log("Ошибка при постановке лайка: ",t)}))},S=function(t){return fetch(_+"/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:f}}).then(m).catch((function(t){console.log("Ошибка при снятии лайка: ",t)}))};function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}document.addEventListener("DOMContentLoaded",(function(){v().then((function(t){document.querySelector(".profile__image").style.backgroundImage="url(".concat(t.avatar,")"),O.textContent=t.name,D.textContent=t.about,j.value=t.name,z.value=t.about}))}));var g=document.querySelector(".places__list");Promise.all([fetch(_+"/cards",{method:"GET",headers:{authorization:f}}).then(m).catch((function(t){console.log("Ошибка при загрузке карточек: ",t)})),v()]).then((function(t){var r,c,u=(c=2,function(t){if(Array.isArray(t))return t}(r=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,u,a=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(a.push(o.value),a.length!==e);i=!0);}catch(t){l=!0,r=t}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw r}}return a}}(r,c)||function(t,e){if(t){if("string"==typeof t)return b(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}(r,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=u[0],i=u[1]._id;a.forEach((function(t){var r=e(t,n,o,H,i,y,h,S);g.append(r)}))}));var q=document.querySelector(".popup_type_edit"),E=document.querySelector(".popup_type_new-card"),C=document.querySelector(".popup_type_update-avatar"),L=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__add-button"),A=document.querySelectorAll(".popup__close"),x=document.querySelector(".profile__image"),T=document.forms["edit-profile"],B=document.forms["new-place"],w=document.forms["update-avatar"],j=T.querySelector(".popup__input_type_name"),z=T.querySelector(".popup__input_type_description"),O=document.querySelector(".profile__title"),D=document.querySelector(".profile__description"),P=B.querySelector(".popup__input_type_card-name"),I=B.querySelector(".popup__input_type_url"),M=w.querySelector(".popup__input_type_url");function N(){j.value=O.textContent,z.value=D.textContent}L.addEventListener("click",(function(){r(q,N),X(q,{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive"})})),k.addEventListener("click",(function(){r(E),X(E,{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive"}),P.value="",I.value=" "})),x.addEventListener("click",(function(){r(C),X(C,{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive"}),M.value=""})),A.forEach((function(t){t.addEventListener("click",c)})),T.addEventListener("submit",(function(t){t.preventDefault();var e,n,o=j.value,r=z.value,c=t.target.querySelector(".popup__button");U(c,"Сохранение...",!0),(e=o,n=r,fetch(_+"/users/me",{method:"PATCH",headers:{authorization:f,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then(m).catch((function(t){console.log("Ошибка при обновлении профиля: ",t)}))).then((function(t){O.textContent=t.name,D.textContent=t.about,U(c,"Сохранить",!1),u()}))})),B.addEventListener("submit",(function(t){t.preventDefault();var r,c=P.value,a=I.value,i=t.target.querySelector(".popup__button");U(i,"Сохранение...",!0),(r={name:c,link:a},fetch(_+"/cards",{method:"POST",headers:{authorization:f,"Content-Type":"application/json"},body:JSON.stringify({name:r.name,link:r.link})}).then(m).catch((function(t){console.log("Ошибка при добавлении карточки: ",t)}))).then((function(t){var r=e(t,n,o,H);g.prepend(r),B.reset(),U(i,"Сохранить",!1),u()}))}));var G=document.querySelector(".popup_type_image .popup__image"),J=document.querySelector(".popup_type_image .popup__caption");function H(t,e){r(document.querySelector(".popup_type_image"),(function(){!function(t,e){G.src=t,G.alt=e,J.textContent=e}(t,e)}))}function U(t,e,n){t.textContent=e,t.disabled=n}w.addEventListener("submit",(function(t){t.preventDefault();var e,n=M.value,o=t.target.querySelector(".popup__button");U(o,"Сохранение...",!0),(e=n,fetch(_+"/users/me/avatar",{method:"PATCH",headers:{authorization:f,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then(m).catch((function(t){console.log("Ошибка при обновлении аватара: ",t)}))).then((function(t){document.querySelector(".profile__image").style.backgroundImage="url(".concat(t.avatar,")"),U(o,"Сохранить",!1),u()}))}));var V,$,F,K,Q,R,W,X=function(t,e){var n=e.inputSelector,o=e.submitButtonSelector,r=e.inactiveButtonClass,c=Array.from(t.querySelectorAll(n)),u=t.querySelector(o);c.forEach((function(e){var n=t.querySelector(".".concat(e.name,"-input-error"));e.classList.remove("popup__input_type_error"),n.textContent="",n.classList.remove("popup__input-error")})),u.disabled=!0,u.classList.add(r)};$=(V={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error"}).formSelector,F=V.inputSelector,K=V.submitButtonSelector,Q=V.inactiveButtonClass,R=V.inputErrorClass,W=V.errorClass,Array.from(document.querySelectorAll($)).forEach((function(t){!function(t,e,n,o,r,c){var u=Array.from(t.querySelectorAll(e)),a=t.querySelector(n);s(u,a,o),u.forEach((function(e){e.addEventListener("input",(function(){(function(t,e,n,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?p(t,e,n,o):l(t,e,e.validationMessage,n,o)})(t,e,r,c),s(u,a,o)}))}))}(t,F,K,Q,R,W)})),fetch(_+"/cards",{method:"GET",headers:{authorization:f}}).then(m).catch((function(t){console.log("Ошибка при подсчете лайков: ",t)})).then((function(t){var e=document.querySelectorAll(".card");t.forEach((function(t){e.forEach((function(e){e.getAttribute("data-id")===t._id&&(e.querySelector(".card__like-count").textContent=t.likes.length)}))}))}))})();
//# sourceMappingURL=main.js.map